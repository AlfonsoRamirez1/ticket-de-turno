{% extends "base_admin.html" %}

{% block title %}Gestionar Oficinas Regionales{% endblock %}

{% block content %}
  <div class="admin-nav" style="align-items: center;">
    <h1>Gestionar Oficinas Regionales</h1>
    <a href="{{ url_for('admin_catalogos_menu') }}">Volver a Catálogos</a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h2>Crear Nueva Oficina</h2>
  <form class="crear-form crear-form-grid" method="POST" action="{{ url_for('admin_oficinas_crear') }}">
    <div class="form-field">
      <label for="nombre">Nombre de la Oficina:</label>
      <input type="text" id="nombre" name="nombre" class="text-box" required>
    </div>
    <div class="form-field">
      <label for="id_municipio">Municipio:</label>
      <select id="id_municipio" name="id_municipio" class="combo-box" required>
        <option value="">Seleccione...</option>
        {% for m in municipios %}
        <option value="{{ m.id_municipio }}">{{ m.municipio }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-actions">
      <button type="submit">Crear</button>
    </div>
  </form>

  <h2>Oficinas Existentes</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre de la Oficina</th>
        <th>Municipio</th>
        <th style="width: 180px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for o in oficinas %}
        <tr>
          <td data-label="ID">{{ o.id_oficina }}</td>
          <td data-label="Nombre de la Oficina">{{ o.oficina }}</td>
          <td data-label="Municipio">{{ o.municipio.municipio or 'N/A' }}</td>
          <td class="action-buttons" data-label="Acciones">
            <a href="{{ url_for('admin_oficinas_editar_get', id_oficina=o.id_oficina) }}" class="btn-editar-cat">
              Editar
            </a>
            <form method="POST" action="{{ url_for('admin_oficinas_eliminar') }}">
              <input type="hidden" name="id_oficina" value="{{ o.id_oficina }}">
              <button type="submit" class="btn-eliminar"
                      onclick="return confirm('¿Está seguro? Si la oficina está en uso, no se podrá eliminar.')">
                Eliminar
              </button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="4" style="text-align: center;">No hay oficinas registradas.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}